{"url":"https://api.github.com/repos/willmcgugan/rich/issues/828","repository_url":"https://api.github.com/repos/willmcgugan/rich","labels_url":"https://api.github.com/repos/willmcgugan/rich/issues/828/labels{/name}","comments_url":"https://api.github.com/repos/willmcgugan/rich/issues/828/comments","events_url":"https://api.github.com/repos/willmcgugan/rich/issues/828/events","html_url":"https://github.com/willmcgugan/rich/issues/828","id":769850221,"node_id":"MDU6SXNzdWU3Njk4NTAyMjE=","number":828,"title":"[BUG] Conflict between rich progress and click.echo()","user":{"login":"serhiy-storchaka","id":3659035,"node_id":"MDQ6VXNlcjM2NTkwMzU=","avatar_url":"https://avatars3.githubusercontent.com/u/3659035?v=4","gravatar_id":"","url":"https://api.github.com/users/serhiy-storchaka","html_url":"https://github.com/serhiy-storchaka","followers_url":"https://api.github.com/users/serhiy-storchaka/followers","following_url":"https://api.github.com/users/serhiy-storchaka/following{/other_user}","gists_url":"https://api.github.com/users/serhiy-storchaka/gists{/gist_id}","starred_url":"https://api.github.com/users/serhiy-storchaka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serhiy-storchaka/subscriptions","organizations_url":"https://api.github.com/users/serhiy-storchaka/orgs","repos_url":"https://api.github.com/users/serhiy-storchaka/repos","events_url":"https://api.github.com/users/serhiy-storchaka/events{/privacy}","received_events_url":"https://api.github.com/users/serhiy-storchaka/received_events","type":"User","site_admin":false},"labels":[{"id":1809645463,"node_id":"MDU6TGFiZWwxODA5NjQ1NDYz","url":"https://api.github.com/repos/willmcgugan/rich/labels/accepted","name":"accepted","color":"c5def5","default":false,"description":"Task was accepted"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-12-17T10:44:20Z","updated_at":"2020-12-18T16:11:05Z","closed_at":"2020-12-18T16:11:05Z","author_association":"NONE","active_lock_reason":null,"body":"There is a conflict between `rich.progress.Progress` and `click.echo()`.\r\n\r\nThe `rich.progress.Progress` context manager monkey-patches `sys.stdout`. `click.echo()` detects whether `sys.stdout` is a text stream or byte stream (this is questionable, but it is a different issue) by trying to write an empty bytes object. If the test is passed successfully, then it is a bytes stream, and click encodes string before writing it. But the wrapper instantiated by Progress ignores empty input for `write()`, including empty bytes object, therefore `click.echo()` concludes that it is a byte stream.\r\n\r\nExample:\r\n```python\r\nimport click\r\nfrom rich.progress import Progress\r\nwith Progress():\r\n    click.echo('test')\r\n```\r\nTraceback:\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \".../site-packages/click/utils.py\", line 272, in echo\r\n    file.write(message)\r\n  File \".../site-packages/rich/progress.py\", line 491, in write\r\n    line, new_line, text = text.partition(\"\\n\")\r\nTypeError: a bytes-like object is required, not 'str'\r\n```\r\n\r\nIt is not completely a failure of rich, but it would be better if the wrapper better emulate output text stream. In particularly check that the argument of `write()` is string.\r\n\r\nrich 9.3.0","closed_by":{"login":"willmcgugan","id":554369,"node_id":"MDQ6VXNlcjU1NDM2OQ==","avatar_url":"https://avatars3.githubusercontent.com/u/554369?v=4","gravatar_id":"","url":"https://api.github.com/users/willmcgugan","html_url":"https://github.com/willmcgugan","followers_url":"https://api.github.com/users/willmcgugan/followers","following_url":"https://api.github.com/users/willmcgugan/following{/other_user}","gists_url":"https://api.github.com/users/willmcgugan/gists{/gist_id}","starred_url":"https://api.github.com/users/willmcgugan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willmcgugan/subscriptions","organizations_url":"https://api.github.com/users/willmcgugan/orgs","repos_url":"https://api.github.com/users/willmcgugan/repos","events_url":"https://api.github.com/users/willmcgugan/events{/privacy}","received_events_url":"https://api.github.com/users/willmcgugan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}