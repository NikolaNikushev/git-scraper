{"url":"https://api.github.com/repos/willmcgugan/rich/issues/189","repository_url":"https://api.github.com/repos/willmcgugan/rich","labels_url":"https://api.github.com/repos/willmcgugan/rich/issues/189/labels{/name}","comments_url":"https://api.github.com/repos/willmcgugan/rich/issues/189/comments","events_url":"https://api.github.com/repos/willmcgugan/rich/issues/189/events","html_url":"https://github.com/willmcgugan/rich/issues/189","id":667678180,"node_id":"MDU6SXNzdWU2Njc2NzgxODA=","number":189,"title":"[BUG] track progressbar is not working correctly with asyncio after rich 4.1.0","user":{"login":"Niraj-Kamdar","id":51387861,"node_id":"MDQ6VXNlcjUxMzg3ODYx","avatar_url":"https://avatars0.githubusercontent.com/u/51387861?v=4","gravatar_id":"","url":"https://api.github.com/users/Niraj-Kamdar","html_url":"https://github.com/Niraj-Kamdar","followers_url":"https://api.github.com/users/Niraj-Kamdar/followers","following_url":"https://api.github.com/users/Niraj-Kamdar/following{/other_user}","gists_url":"https://api.github.com/users/Niraj-Kamdar/gists{/gist_id}","starred_url":"https://api.github.com/users/Niraj-Kamdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Niraj-Kamdar/subscriptions","organizations_url":"https://api.github.com/users/Niraj-Kamdar/orgs","repos_url":"https://api.github.com/users/Niraj-Kamdar/repos","events_url":"https://api.github.com/users/Niraj-Kamdar/events{/privacy}","received_events_url":"https://api.github.com/users/Niraj-Kamdar/received_events","type":"User","site_admin":false},"labels":[{"id":2200581776,"node_id":"MDU6TGFiZWwyMjAwNTgxNzc2","url":"https://api.github.com/repos/willmcgugan/rich/labels/Needs%20triage","name":"Needs triage","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-07-29T09:05:29Z","updated_at":"2020-07-29T22:47:04Z","closed_at":"2020-07-29T22:47:04Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the bug**\r\ntrack stops iterating after producing one value while running asynchronously.\r\n\r\n**To Reproduce**\r\nFollowing code is just to simulate bug. I am using rich progress bar to track progress of asynchronous downloading tasks.\r\n```python\r\nasync def sleeper(val):\r\n    await asyncio.sleep(1)\r\n    return val\r\n\r\n\r\nasync def scheduler():\r\n    tasks = [sleeper(i) for i in range(10)]\r\n    total_tasks = len(tasks)\r\n    for task in track(\r\n            asyncio.as_completed(tasks),\r\n            description=\"Processing...\",\r\n            total=total_tasks,\r\n    ):\r\n        await task\r\n\r\n\r\ndef get_event_loop():\r\n    try:\r\n        loop = asyncio.get_event_loop()\r\n    except RuntimeError:\r\n        loop = asyncio.new_event_loop()\r\n        asyncio.set_event_loop(loop)\r\n    if sys.platform.startswith(\"win\"):\r\n        if isinstance(loop, asyncio.SelectorEventLoop):\r\n            loop = asyncio.ProactorEventLoop()\r\n            asyncio.set_event_loop(loop)\r\n    return loop\r\n\r\n\r\ndef run_coroutine(coro):\r\n    loop = get_event_loop()\r\n    aws = asyncio.ensure_future(coro)\r\n    result = loop.run_until_complete(aws)\r\n    return result\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    run_coroutine(scheduler())\r\n```\r\n\r\n**Platform**\r\nWhat platform (Win/Linux/Mac) are you running on?  \r\nI have tried on both Linux and Windows and both are producing same bug.\r\n\r\nWhat terminal software are you using?\r\nbash terminal on linux and powershell on windows.\r\n\r\nWhich version of Rich?\r\nrich>=4.1.0 produces this bug. Works fine in rich<=4.0.0\r\n","closed_by":{"login":"willmcgugan","id":554369,"node_id":"MDQ6VXNlcjU1NDM2OQ==","avatar_url":"https://avatars3.githubusercontent.com/u/554369?v=4","gravatar_id":"","url":"https://api.github.com/users/willmcgugan","html_url":"https://github.com/willmcgugan","followers_url":"https://api.github.com/users/willmcgugan/followers","following_url":"https://api.github.com/users/willmcgugan/following{/other_user}","gists_url":"https://api.github.com/users/willmcgugan/gists{/gist_id}","starred_url":"https://api.github.com/users/willmcgugan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willmcgugan/subscriptions","organizations_url":"https://api.github.com/users/willmcgugan/orgs","repos_url":"https://api.github.com/users/willmcgugan/repos","events_url":"https://api.github.com/users/willmcgugan/events{/privacy}","received_events_url":"https://api.github.com/users/willmcgugan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}