{"url":"https://api.github.com/repos/willmcgugan/rich/issues/472","repository_url":"https://api.github.com/repos/willmcgugan/rich","labels_url":"https://api.github.com/repos/willmcgugan/rich/issues/472/labels{/name}","comments_url":"https://api.github.com/repos/willmcgugan/rich/issues/472/comments","events_url":"https://api.github.com/repos/willmcgugan/rich/issues/472/events","html_url":"https://github.com/willmcgugan/rich/issues/472","id":758127213,"node_id":"MDU6SXNzdWU3NTgxMjcyMTM=","number":472,"title":"[REQUEST]Live display flickered when it in a daemon thread","user":{"login":"DarrenIce","id":34674240,"node_id":"MDQ6VXNlcjM0Njc0MjQw","avatar_url":"https://avatars1.githubusercontent.com/u/34674240?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenIce","html_url":"https://github.com/DarrenIce","followers_url":"https://api.github.com/users/DarrenIce/followers","following_url":"https://api.github.com/users/DarrenIce/following{/other_user}","gists_url":"https://api.github.com/users/DarrenIce/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenIce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenIce/subscriptions","organizations_url":"https://api.github.com/users/DarrenIce/orgs","repos_url":"https://api.github.com/users/DarrenIce/repos","events_url":"https://api.github.com/users/DarrenIce/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenIce/received_events","type":"User","site_admin":false},"labels":[{"id":2200581776,"node_id":"MDU6TGFiZWwyMjAwNTgxNzc2","url":"https://api.github.com/repos/willmcgugan/rich/labels/Needs%20triage","name":"Needs triage","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-12-07T03:41:24Z","updated_at":"2020-12-07T08:50:04Z","closed_at":"2020-12-07T08:50:04Z","author_association":"NONE","active_lock_reason":null,"body":"I run the examples/top_lite_simulator.py and I want to run it in a daemon thread.\r\nWhen I do that, the output flickered.\r\nI have no idea how to solve it. Could you help me about that?\r\nHere is the code.\r\n```python\r\nimport datetime\r\nimport random\r\nimport time\r\nimport threading\r\nfrom dataclasses import dataclass\r\n\r\nfrom rich import box\r\nfrom rich.console import Console\r\nfrom rich.live import Live\r\nfrom rich.table import Table\r\nfrom typing_extensions import Literal\r\n\r\n\r\n@dataclass\r\nclass Process:\r\n    pid: int\r\n    command: str\r\n    cpu_percent: float\r\n    memory: int\r\n    start_time: datetime.datetime\r\n    thread_count: int\r\n    state: Literal[\"running\", \"sleeping\"]\r\n\r\n    @property\r\n    def memory_str(self) -> str:\r\n        if self.memory > 1e6:\r\n            return f\"{int(self.memory/1e6)}M\"\r\n        if self.memory > 1e3:\r\n            return f\"{int(self.memory/1e3)}K\"\r\n        return str(self.memory)\r\n\r\n    @property\r\n    def time_str(self) -> str:\r\n        return str(datetime.datetime.now() - self.start_time)\r\n\r\nclass Simulator():\r\n    def __init__(self):\r\n        self.console = Console(force_terminal=True, color_system='truecolor')\r\n        self.console._environ['TERM'] = 'SMART'\r\n\r\n    def generate_process(self,pid: int) -> Process:\r\n        return Process(\r\n            pid=pid,\r\n            command=f\"Process {pid}\",\r\n            cpu_percent=random.random() * 20,\r\n            memory=random.randint(10, 200) ** 3,\r\n            start_time=datetime.datetime.now()\r\n            - datetime.timedelta(seconds=random.randint(0, 500) ** 2),\r\n            thread_count=random.randint(1, 32),\r\n            state=\"running\" if random.randint(0, 10) < 8 else \"sleeping\",\r\n        )\r\n\r\n\r\n    def create_process_table(self,height: int) -> Table:\r\n\r\n        processes = sorted(\r\n            [self.generate_process(pid) for pid in range(height)],\r\n            key=lambda p: p.cpu_percent,\r\n            reverse=True,\r\n        )\r\n        table = Table(\r\n            \"PID\", \"Command\", \"CPU %\", \"Memory\", \"Time\", \"Thread #\", \"State\", box=box.SIMPLE\r\n        )\r\n\r\n        for process in processes:\r\n            table.add_row(\r\n                str(process.pid),\r\n                process.command,\r\n                f\"{process.cpu_percent:.1f}\",\r\n                process.memory_str,\r\n                process.time_str,\r\n                str(process.thread_count),\r\n                process.state,\r\n            )\r\n\r\n        return table\r\n\r\n    def run(self):\r\n        with Live(console=self.console, transient=True, auto_refresh=False) as live:\r\n            while True:\r\n                live.update(self.create_process_table(self.console.size.height - 4), refresh=True)\r\n                time.sleep(1)\r\n\r\n\r\nsimu = Simulator()\r\na = threading.Thread(target=simu.run,daemon=True)\r\na.start()\r\n\r\nwhile True:\r\n    continue\r\n```","closed_by":{"login":"DarrenIce","id":34674240,"node_id":"MDQ6VXNlcjM0Njc0MjQw","avatar_url":"https://avatars1.githubusercontent.com/u/34674240?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenIce","html_url":"https://github.com/DarrenIce","followers_url":"https://api.github.com/users/DarrenIce/followers","following_url":"https://api.github.com/users/DarrenIce/following{/other_user}","gists_url":"https://api.github.com/users/DarrenIce/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenIce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenIce/subscriptions","organizations_url":"https://api.github.com/users/DarrenIce/orgs","repos_url":"https://api.github.com/users/DarrenIce/repos","events_url":"https://api.github.com/users/DarrenIce/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenIce/received_events","type":"User","site_admin":false},"performed_via_github_app":null}